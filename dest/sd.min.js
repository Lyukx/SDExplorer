!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.displayName=t.name,this.fqcn=t.fqcn,void 0!=t.type&&(this.displayName+=":"+t.type),this.parent=-1,this.children=[],this.fold=!0,this.x=0,this.y=0,this.height=U,this.width=this.displayName.length*I+2*N}function r(t,r){!function(t,r){j=new Map,W=[],t.forEach(function(t){var r=new e(t);j.set(r.id,r)}),r.forEach(function(t){var r=new e(t);r.children=t.objs,j.set(r.id,r)}),r.forEach(function(e){t=e.objs;for(var r=0;r<t.length;r++)j.get(t[r]).parent=e.id})}(t,r),j.forEach(function(t,e,r){-1==t.parent&&W.push(t)}),W.sort(function(t,e){var r=t.id,a=e.id;return t.isGroup()&&(r=t.children[0]),e.isGroup()&&(a=e.children[0]),r-a});for(var o=R,s=0;s<W.length;s++)W[s].x=o,o+=W[s].width+R;a(),this.display=W,this.elementMap=j,this.displaySet=X}function a(){X.clear();for(let t of W)t.isGroup()&&!t.fold||X.add(t.id)}function o(t){this.from=t.from,this.id=t.id,this.count=t.count,this.valid=!1,this.scale=1,this.position=0,this.fromOffset=0,this.toOffset=0,1!=t.return?-1==t.to?this.return=!0:(this.to=t.to,this.message=t.message):this.return=t.return,void 0!=t.thread&&(this.thread=t.thread)}function s(t,e,r,a){z=[],Y=new Map,q=[];for(let e of t){var s=new o(e);q.push(s),s.isReturn()||Y.set(s.id,{from:s.from,to:s.to})}for(let t of q)if(-1!=t.to){for(;!r.has(t.from);){if(void 0==a.get(t.from)){t.from=-1;break}if(-1==(i=a.get(t.from).parent))break;t.from=i}for(;!r.has(t.to);){if(void 0==a.get(t.to)){t.to=-1;break}var i=a.get(t.to).parent;if(-1==i)break;t.to=i}}_=e,n(),this.validMessages=z}function n(){T=[];for(var t=new Set,e=0;e<q.length;e++){var r=q[e];r.isReturn()?t.has(r.id)&&T.push(r):-1!=r.from&&-1!=r.to?(T.push(r),t.add(r.id)):r.valid=!1}z.length=0;for(var a=[],o=new i,s=new Map,n=P/4,e=0;e<T.length;e++){var l=T[e];if(l.isReturn()){var d=s.get(l.id)[0],f=e-s.get(l.id)[1];n+=P/2,d.scale=(f+1)/2,o.pop()}else s.set(l.id,[l,e]),n+=P/2,l.position=n,o.push(l),l.fromOffset=o.getOffset(l.from),l.toOffset=o.getOffset(l.to),l.valid||a.push(l),l.valid=!0,z.push(l)}for(var c=T.length;!o.isEmpty();){var p=o.pop(),f=c-s.get(p.id)[1];n+=P/2,p.scale=(f+1)/2,c++}return a}function i(){this.stack=[],this.offset=new Map;for(let t of _)this.offset.set(t,0)}function l(){}function d(t,e,a){V=new r(t,e),$=V.elementMap,Z=V.display,tt=V.displaySet,this.logger=at,Q=new Set([0]);for(var o=$.get(0);-1!=o.parent;)Q.add(o.parent),o=$.get(o.parent);K=[0],J=new s(a,Q,tt,$),et=J.validMessages,g()}function f(t){V.unfoldUpdateStatus(t.id),function(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?(d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")").style("opacity",0)):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))}),Z.forEach(function(t){xt=Math.max(xt,t.height)});for(var r=0;r<t.children.length;r++){var a=t.children[r],o=$.get(a),s=m(o);s.attr("transform","translate("+t.x+", "+(t.y+vt)+")"),s.transition().attr("transform","translate("+o.x+", "+o.y+")"),d3.select("#baseLine"+a).transition().attr("transform","translate("+o.x+", "+o.y+")")}}(t);x(J.unfoldUpdateStatus(tt,$)),u(),at.logUnfold(t)}function c(t){V.foldUpdateStatus(t.id),function(t,e){d3.selectAll(".element").each(function(e){-1!=t.children.indexOf(e.id)?(d3.select("#baseLine"+e.id).remove(),d3.select(this).remove()):e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),xt=Math.max(xt,e.height),e==t?(d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().style("opacity",1).attr("transform","translate("+e.x+", "+e.y+")")):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))}),xt=ut,Z.forEach(function(t){xt=Math.max(xt,t.height)})}(t),J.unfoldUpdateStatus(tt,$),x([]),u(),at.logFold(t)}function p(t){for(var e=0;e<t.children.length;e++){var r=$.get(t.children[e]);if(r.isGroup()&&!r.fold)return!1}return!0}function h(t){var e=[];for(e.push(t);0!=e.length;){var r=e[e.length-1];if(p(r))c(r),e.splice(e.length-1,1);else for(var a=0;a<r.children.length;a++){var o=$.get(r.children[a]);o.isGroup()&&(p(o)?c(o):e.push(o))}}}function u(){for(var t=0,e=lt;e<lt+nt&&!(e>=Z.length);e++)t=Math.min(Z[e].y,t);var r=parseInt(d3.select(".objects-layout").attr("transform").split(/,|\)/)[1]);void 0==d.prototype.top?(d3.select(".objects-layout").attr("transform","translate(0,"+(r-t)+")"),d.prototype.top=t):d.prototype.top!=t&&(d3.select(".objects-layout").attr("transform","translate(0,"+(r+d.prototype.top-t)+")"),d.prototype.top=t)}function g(){d3.select("svg").append("g").attr("class","baseline-layout"),d3.select("svg").append("g").attr("class","mainthread-layout"),d3.select("svg").append("g").attr("class","messages-layout"),d3.select("svg").append("g").attr("class","loop-layout"),d3.select("svg").append("g").attr("class","objects-layout").attr("transform","translate(0, 0)")}function m(t){var e=d3.select(".objects-layout").append("g"),r=(t.displayName.length*gt+2*yt)/2,a=(ct&&dt+it<et.length?it:et.length)*bt+ut+bt/2;d3.select(".baseline-layout").append("line").attr("class","baseLine").attr("x1",r).attr("y1",0).attr("x2",r).attr("y2",a).style("stroke","black").style("stroke-dasharray","2,2,2").attr("id","baseLine"+t.id).attr("transform","translate("+t.x+", "+t.y+")");var o=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");o.on({mouseenter:function(){enterAction(t,this)},mouseleave:function(){leaveAction(t,this)}}),t.isGroup()?o.style("fill","yellow"):o.style("fill","white");e.append("text").text(function(e){return t.displayName}).attr("transform","translate("+r+","+(ut/2+mt)+")").attr("text-anchor","middle").attr("font-family","Consolas");return e.attr("class","element").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),t.isGroup()&&e.on("click",function(t){t.fold?f(t):h(t)}),t.isGroup()&&!t.fold&&(e.style("fill-opacity","0"),d3.select("#baseLine"+t.id).style("opacity",0)),e}function y(t){var e=$.get(t.from),r=$.get(t.to),a=e.x+e.width/2-wt/2+t.fromOffset*wt,o=t.position+Mt,s=t.scale*bt-2*Mt,n=r.x+r.width/2-wt/2+t.toOffset*wt,i=o+Mt,l=s-2*Mt;if(ct){var d=lt>0?Z[lt-1].x:Z[0].x,f=lt+nt;f>=Z.length&&(f=Z.length-1);var c=Z[f].x+Z[f].width;a<d&&(a=d),n>c&&(n=c)}var p=$.get(t.from).x<=$.get(t.to).x,h=d3.select(".messages-layout").append("g"),u=h.append("text").attr("class","message-text").text(function(e){return t.message});p?u.attr("transform","translate("+(a+yt)+","+o+")"):u.attr("transform","translate("+(a-wt)+","+o+")").attr("text-anchor","end");var g=h.append("line").attr("class","callLine").style("stroke","black").attr("x1",p?a+wt:a).attr("y1",i).attr("x2",p?n:n+wt).attr("y2",i).attr("marker-end","url(#end)"),m=h.append("line").attr("class","callBackLine").style("stroke","black").style("stroke-dasharray","5, 5, 5").attr("x1",p?n:n+wt).attr("y1",i+l).attr("x2",p?a+wt:a).attr("y2",i+l).attr("marker-end","url(#end)"),y="#CCC";void 0!=t.thread&&(-1==ot.indexOf(t.thread)&&ot.push(t.thread),y=st[ot.indexOf(t.thread)%st.length]);var x=h.append("rect").attr("class","rightActiveBlock").attr({x:0,y:0,width:wt,height:l}).attr("transform","translate("+n+","+i+")").style("stroke","black").style("fill",y);h.attr("class","message").datum(t),e==r&&(x.attr({y:5,height:l-5}),h.append("line").style("stroke","black").attr("x1",a).attr("y1",i).attr("x2",n+wt+20).attr("y2",i),h.append("line").style("stroke","black").attr("x1",n+wt+20).attr("y1",i).attr("x2",n+wt+20).attr("y2",i+12),g.attr("x1",n+wt+20).attr("y1",i+12).attr("x2",n+wt).attr("y2",i+12),m.remove(),x.style("fill","#666"),u.attr("transform","translate("+(a+yt-15)+","+o+")")),h.append("rect").attr("class","message-click-active-block").attr({x:-yt,y:-yt,width:2*yt+Math.abs(n-a),height:2*yt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")").style("fill","#99ccff").style("fill-opacity","0").datum(t.id),h.attr("class","message").attr("data-message-id",t.id).datum(t).on("dblclick",function(e){var r=d3.select(this).select(".message-click-active-block");if(void 0!=ht)if(ht.style("fill-opacity","0"),ht.datum()!=r.datum()){r.style("fill-opacity","0.4"),ht=r;var a=d3.mouse(this)[0],o=d3.mouse(this)[1];d3.select(".hint-box").remove(),v(t.from,t.to,t.message,a,o,t.id),ft=t,at.logHinitbox(t.id)}else ht=void 0,d3.select(".hint-box").remove(),ft=void 0;else{r.style("fill-opacity","0.4"),ht=r;var a=d3.mouse(this)[0],o=d3.mouse(this)[1];v(t.from,t.to,t.message,a,o,t.id),ft=t,at.logHinitbox(t.id)}clickSequenceToLine(t.id)})}function v(t,e,r,a,o,s){var n=d3.select("svg").append("g").attr("class","hint-box"),i=$.get(t).displayName,l=$.get(e).displayName,d=1,f=d3.select("svg");if(null!=f[0][0]){f=f.attr("viewBox");var c=window.innerWidth;d=f.split(" ")[2]/c}var p=(Math.max(i.length,l.length,r.length)+8)*gt+2*yt;n.append("rect").attr({x:0,y:0,width:p,height:kt}).style("fill","#FEF8DE").style("stroke","black"),n.append("text").text(function(t){return"Caller: "+i}).attr("transform","translate("+yt+","+(kt/8+mt)+")").style("font-family","Courier New"),n.append("text").text(function(t){return"Callee: "+l}).attr("transform","translate("+yt+","+(kt/8*3+mt)+")").style("font-family","Courier New"),n.append("text").text(function(t){return"Method: "+r}).attr("transform","translate("+yt+","+(kt/8*5+mt)+")").style("font-family","Courier New");n.append("text").text(function(t){return"remove this call"}).attr("transform","translate("+yt+","+(kt/8*7+mt)+")").attr("class","remove").attr("fill","#7099ff").attr("font-weight","bold").attr("cursor","pointer").style("font-family","Courier New").on("click",function(){onclick(s)}),n.attr("transform","translate("+a+","+o+") scale("+d+")")}function x(t){for(let e of t)e.valid&&y(e);d3.selectAll(".message").each(function(t){if(t.valid){var e=$.get(t.from),r=$.get(t.to),a=e.x+e.width/2-wt/2+t.fromOffset*wt,o=t.position+Mt,s=t.scale*bt-2*Mt,n=r.x+r.width/2-wt/2+t.toOffset*wt,i=o+Mt,l=s-2*Mt,d=$.get(t.from).x<$.get(t.to).x;d?d3.select(this).select(".message-text").transition().attr("transform","translate("+(a+yt)+","+o+")"):d3.select(this).select(".message-text").transition().attr("transform","translate("+(a-wt)+","+o+")"),d3.select(this).select(".callLine").transition().attr("x1",d?a+wt:a).attr("y1",i).attr("x2",d?n:n+wt).attr("y2",i),d3.select(this).select(".callBackLine").transition().attr("x1",d?n:n+wt).attr("y1",i+l).attr("x2",d?a+wt:a).attr("y2",i+l),d3.select(this).select(".rightActiveBlock").transition().attr({x:0,y:0,width:wt,height:l}).attr("transform","translate("+n+","+i+")"),d3.select(this).select(".message-click-active-block").transition().attr({x:-yt,y:-yt,width:2*yt+Math.abs(n-a),height:2*yt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")")}else d3.select(this).remove()}),M(),b()}function w(){for(let o of K){for(var t=$.get(o);!tt.has(t.id)&&-1!=t.parent;)t=$.get(t.parent);var e=t.x+t.width/2-wt/2,r=.75*bt,a=et.length*bt;d3.select(".mainthread-layout").append("rect").attr("class","mainThreadActiveBar").attr({x:0,y:0,width:wt,height:a}).attr("transform","translate("+e+","+r+")").style("stroke","black").style("fill","#CCC")}}function b(){d3.selectAll(".mainThreadActiveBar").remove(),w()}function M(){var t=(ct&&dt+it<et.length?it:et.length)*bt+ut+bt/2;d3.selectAll(".baseLine").attr("y2",t)}function k(){d3.select(".loop-layout").selectAll("*").remove();var t=new Map;for(let e of et)t.set(e.id,e);for(let h of rt){var e=h.represent,r=Number.MAX_SAFE_INTEGER,a=0,o=void 0;for(let c of e){var s=t.get(c.id);void 0==o&&(o=s);var n=$.get(s.from),i=$.get(s.to),l=n.x+n.width/2,d=i.x+i.width/2;if(l>d){f=l;l=d,d=f}d+=60,(l-=95)<r&&(r=l),d>a&&(a=d)}var f,c=o.position-10,p=e.length*bt;(f=d3.select(".loop-layout").append("g")).attr("class","loop").datum(e[0]),f.append("line").attr({x1:0,y1:0,x2:a-r,y2:0}).style("stroke","blue"),f.append("line").attr({x1:0,y1:p,x2:a-r,y2:p}).style("stroke","blue"),f.append("line").attr({x1:0,y1:0,x2:0,y2:p}).style("stroke","blue"),f.append("line").attr({x1:a-r,y1:0,x2:a-r,y2:p}).style("stroke","blue"),f.append("rect").attr({x:0,y:0,width:80,height:20}).style("fill","white").style("stroke","blue").style("fill-opacity","1"),f.append("text").text(function(t){return"loop <"+h.repeat+">"}).attr("transform","translate(4, 16)"),f.attr("transform","translate("+r+","+c+")")}}function A(t,e){this.represent=t,this.repeat=e,this.children=[],this.depth=1}function L(t,e,r){for(var a=e;a<e+r;a++)if(!t[a].sameRepresent(t[a+r]))return!1;return!0}function E(t,e,r,a){for(var o=[],s=[],n=0,i=e;i<e+r;i++)o=o.concat(t[i].represent),s.push(t[i]),t[i].depth>n&&(n=t[i].depth);var l=new A(o,a);return l.children=s,l.depth=n+1,l}function F(t){var e=[];if(0==t.children.length)return e;var r=[];for(r.push(t);0!=r.length;){var a=r.pop();e.push(a);for(var o=0;o<a.children.length;o++)a.children[o].repeat>1&&r.push(a.children[o])}return e}function O(t){for(var e=function(t){for(var e=[],r=0;r<t.length;r++)e.push(new A([t[r]],1));for(var a=1,o=100>e.length/2?e.length/2:100;a<=o;){for(r=0;r<=e.length-2*a;r++){for(var s=1;L(e,r,a)&&(e.splice(r+a,a),s++,!(r>e.length-2*a)););if(s>1){var n=E(e,r,a,s);e.splice(r,a,n)}}a++}return e}(t),r=[],a=[],o=0;o<e.length;o++)r=r.concat(F(e[o])),a=a.concat(e[o].represent);this.result=[r,a]}function S(t){void 0!=t.objects&&void 0!=t.messages?(void 0==t.groups&&(t.groups=[]),void 0!=t.width&&(Ot=t.width),void 0!=t.height&&(St=t.height),function(t){void 0==Ot&&(Ot=window.innerWidth);void 0==St&&(St=window.innerHeight-100);[Bt,Gt,Ct,Ht]=[0,0,0,0],Ut=1,Et=-10,Ft=-10,d3.select("svg").remove(),(At=d3.select("#"+t).append("svg").attr("width",Ot).attr("height",St).call(d3.behavior.zoom().scaleExtent([.2,10]).on("zoom",function(){if(Ut!==d3.event.scale){var t=Ut/d3.event.scale;Ut=d3.event.scale,Et=Bt-t*(Bt-Et),Ft=Math.max(Gt-t*(Gt-Ft),2*Lt.top),At.attr("viewBox",Et+" "+Ft+" "+Ot/Ut+" "+St/Ut);var e=d3.select(".hint-box");if(null!=e[0][0]){var r=e.attr("transform").split(" ");e.attr("transform",r[0]+" scale("+1/Ut+")")}G()}}))).attr("viewBox","0 0 "+Ot+" "+St),At.on("dblclick.zoom",null),At.on("mousedown",function(){Dt=!0,Ct=d3.mouse(this)[0],Ht=d3.mouse(this)[1]}),document.body.onmouseup=function(){Dt=!1},At.on("mousemove",function(){Bt=d3.mouse(this)[0],Gt=d3.mouse(this)[1],Dt&&(Et=Et-d3.mouse(this)[0]+Ct,Ft=Math.max(Ft-d3.mouse(this)[1]+Ht,2*Lt.top),At.attr("viewBox",Et+" "+Ft+" "+Ot/Ut+" "+St/Ut),G())}),At.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5")}(t.drawAreaId),Lt=new d(t.objects,t.groups,t.messages),this.rawMessageBeforeComress=t.messages,Lt.initLoopList(),Lt.setDiagramSize(Rt,jt),Lt.setDiagramDisplayHead(Wt,Xt),Lt.drawWindow(),It=Lt.getElementSet(),Nt=Lt.getElementMap(),this.logger=Lt.logger,void 0!=t.loops&&Lt.setLoops(t.loops)):console.log("Error! Objects or messages undefined!")}function B(t,e,r){for(var a=Nt.get(r);-1!=a.parent;)a=Nt.get(a.parent);var o=[];if(a.isGroup()&&!a.fold){var s=t.indexOf(a)+1;for(let e=a.children.length;e>0;e--)t[s].isGroup()&&!t[s].fold&&(e+=t[s].children.length),o.push(t[s]),t.splice(s,1)}if(t.splice(t.indexOf(a),1),t.splice(e,0,a),0!=o.length)for(let r=0;r<o.length;r++)t.splice(e+1+r,0,o[r]);return o.length}function G(){if(-1!=Lt.getMiddleElementX()&&Et>=Lt.getMiddleElementX()&&H(Lt.getMiddleElementIndex(),Xt),Wt>0&&Et<=Lt.getHeadElementX()){(t=Wt-Rt/2)<0&&(t=0),H(t,Xt)}if(-1!=Lt.getMiddleMessageY()&&Ft>=Lt.getMiddleMessageY()&&H(Wt,Lt.getMiddleMessageIndex()),Xt>0&&Ft<=Lt.getHeadMessageY()){var t=Xt-jt/2;t<0&&(t=0),H(Wt,t)}D()}function C(t,e,r,a,o,s){Wt=Math.max(t-Rt/2,0),Xt=Math.max(e-jt/2,0),H(Wt,Xt),Et=r,Ft=a,At.attr("viewBox",Et+" "+Ft+" "+o+" "+s),D()}function H(t,e){Lt.clearAll(),Wt=t,Xt=e,Lt.setDiagramDisplayHead(t,e),Lt.drawWindow()}function D(){d3.select(".objects-layout").attr("transform","translate(0,"+(Ft-Lt.top)+")"),d3.select(".baseline-layout").attr("transform","translate(0,"+(Ft-Lt.top)+")")}var U=40,I=8,N=20;e.prototype.isGroup=function(){return 0!=this.children.length};var R=20,j=[],W=[],X=new Set;r.prototype.updateAfterReOrder=function(){var t=R;for(let e of W)e.x=t,e.isGroup()&&!e.fold?t+=10:t+=e.width+R},r.prototype.getGroupFoldInfo=function(){var t=new Set;for(let e of W)e.isGroup()&&!e.fold&&t.add(e.id);return t},r.prototype.unfoldUpdateStatus=function(t){var e=j.get(t);if(e.fold){for(var r=e.children,o=10,s=W.indexOf(e)+1,n=0;n<r.length;n++){var i=j.get(r[n]);i.x=o+e.x,W.splice(s,0,i),s++,o+=i.width+R}for(var l=o-R+10-e.width;s<W.length;)W[s].x+=l,s++;e.width+=l,e.y-=10,e.height+=20,e.fold=!1;for(var d=e;-1!=d.parent;)(d=j.get(d.parent)).width+=l,d.height+=20,d.y-=10;a()}},r.prototype.foldUpdateStatus=function(t){var e=j.get(t);if(!e.fold){for(var r=e.children,o=0,s=0;s<r.length;s++){var n=j.get(r[s]);o=W.indexOf(n),W.splice(o,1)}for(var i=e.width-(8*e.displayName.length+2*R);o<W.length;)W[o].x-=i,o++;e.width-=i,e.y+=10,e.height-=20,e.fold=!0;for(var l=e;-1!=l.parent;)(l=j.get(l.parent)).width-=i,l.height-=20,l.y+=10;a()}},o.prototype.equals=function(t){return this.from==t.from&&this.to==t.to&&this.message==t.message},o.prototype.isReturn=function(){return 1==this.return};var z,Y,q,T,_,P=80;s.prototype.foldUpdateStatus=function(t){for(let e of q)-1!=e.to&&(-1!=t.children.indexOf(e.from)&&(e.from=t.id),-1!=t.children.indexOf(e.to)&&(e.to=t.id));n()},s.prototype.getRawMessages=function(){return T},s.prototype.unfoldUpdateStatus=function(t,e){for(let a of q)if(-1!=a.to&&-1!=a.from){if(!t.has(a.from))for(a.from=Y.get(a.id).from;!t.has(a.from);){if(-1==(r=e.get(a.from).parent))break;a.from=r}if(!t.has(a.to))for(a.to=Y.get(a.id).to;!t.has(a.to);){var r=e.get(a.to).parent;if(-1==r)break;a.to=r}}return n()},i.prototype.push=function(t){this.stack.push(t),this.offset.has(t.to)?this.offset.set(t.to,this.offset.get(t.to)+1):this.offset.set(t.to,0)},i.prototype.pop=function(){var t=this.stack.pop(),e=this.offset.get(t.to)-1;return e<0?this.offset.delete(t.to):this.offset.set(t.to,e),t},i.prototype.peek=function(){return this.stack[this.stack.length-1]},i.prototype.hasActive=function(t){return this.offset.has(t)},i.prototype.isEmpty=function(){return 0==this.stack.length},i.prototype.getOffset=function(t){return this.offset.has(t)?this.offset.get(t):0},l.prototype.output=function(t){},l.prototype.logFold=function(t){var e={time:Date(),type:"Fold",param:[t.id,t.displayName]};this.output(e)},l.prototype.logUnfold=function(t){var e={time:Date(),type:"Unfold",param:[t.id,t.displayName]};this.output(e)},l.prototype.logHinitbox=function(t){var e={time:Date(),type:"Hintbox",param:[t]};this.output(e)};var V,J,K,Q,Z,$,tt,et,rt=[],at=new l,ot=[],st=["#CCC","#FF0000","#00FF00","0000FF","FFFF00","00FFFF","FF00FF"];d.prototype.draw=function(){g();for(var t=0;t<Z.length;t++)m(Z[t]);w();for(let t of et)y(t)},d.prototype.getMessages=function(){return et},d.prototype.getElementSet=function(){return tt},d.prototype.getElements=function(){return Z},d.prototype.getElementMap=function(){return $},d.prototype.getRawMessages=function(){return J.getRawMessages()},d.prototype.setLoops=function(t){rt=t,k()},d.prototype.initLoopList=function(){rt=[]},d.prototype.updateAfterReOrder=function(){V.updateAfterReOrder()},d.prototype.setMessages=function(t){J=new s(t,Q,tt,$),et=J.validMessages,d3.select(".messages-layout").selectAll("*").remove();for(let t of et)y(t);M(),b()};var nt,it,lt,dt,ft,ct=!1;d.prototype.getHint=function(){return ft},d.prototype.setDiagramSize=function(t,e){nt=t,it=e,ct=!0,this.setDiagramDisplayHead(0,0)},d.prototype.setDiagramDisplayHead=function(t,e){lt=t,dt=e},d.prototype.getMiddleElementIndex=function(){return lt+nt/2},d.prototype.getMiddleElementX=function(){var t=this.getMiddleElementIndex();return t<Z.length?Z[t].x:-1},d.prototype.getHeadElementX=function(){return Z[lt].x},d.prototype.getMiddleMessageIndex=function(){return dt+it/2},d.prototype.getMiddleMessageY=function(){var t=this.getMiddleMessageIndex();return t<et.length?et[t].position:-1},d.prototype.getHeadMessageY=function(){return et[dt].position},d.prototype.getIndexByMessageId=function(t){for(var e=-1,r=-1,a=-1,o=-1,s=0;s<et.length;s++)if(et[s].id==t){r=s,o=et[s].position;break}if(-1!=r)for(var n=0;n<Z.length;n++)if(Z[n].id==et[r].from){e=n,a=Z[n].x;break}return[e,r,a,o-60]},d.prototype.drawWindow=function(){for(t=lt;t<lt+nt&&!(t>=Z.length);t++)m(Z[t]);pt||d3.selectAll(".element").on("click",null),u(),w();for(var t=dt;t<dt+it&&!(t>=et.length);t++)y(et[t]);k()},d.prototype.clearAll=function(){d3.select(".messages-layout").remove(),d3.select(".objects-layout").remove(),d3.select(".loop-layout").remove(),d3.select(".mainthread-layout").remove(),d3.select(".baseline-layout").remove(),d3.select(".hint-box").remove(),ft=void 0,g()},d.prototype.getFoldInfo=function(){return V.getGroupFoldInfo()},d.prototype.updateWithoutAnimation=function(t){for(let e of Z)if(t.has(e.id)){V.unfoldUpdateStatus(group.id),function(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").attr({width:e.width,height:e.height}),e==t?(d3.select(this).style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")").style("opacity",0)):(d3.select(this).attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")"))}),Z.forEach(function(t){xt=Math.max(xt,t.height)});for(var r=0;r<t.children.length;r++){var a=t.children[r],o=$.get(a),s=m(o);s.attr("transform","translate("+t.x+", "+(t.y+vt)+")"),s.attr("transform","translate("+o.x+", "+o.y+")"),d3.select("#baseLine"+a).attr("transform","translate("+o.x+", "+o.y+")")}}(group);!function(t){for(let e of t)e.valid&&y(e);d3.selectAll(".message").each(function(t){if(t.valid){var e=$.get(t.from),r=$.get(t.to),a=e.x+e.width/2-wt/2+t.fromOffset*wt,o=t.position+Mt,s=t.scale*bt-2*Mt,n=r.x+r.width/2-wt/2+t.toOffset*wt,i=o+Mt,l=s-2*Mt,d=$.get(t.from).x<$.get(t.to).x;d?d3.select(this).select(".message-text").attr("transform","translate("+(a+yt)+","+o+")"):d3.select(this).select(".message-text").attr("transform","translate("+(a-wt)+","+o+")"),d3.select(this).select(".callLine").attr("x1",d?a+wt:a).attr("y1",i).attr("x2",d?n:n+wt).attr("y2",i),d3.select(this).select(".callBackLine").attr("x1",d?n:n+wt).attr("y1",i+l).attr("x2",d?a+wt:a).attr("y2",i+l),d3.select(this).select(".rightActiveBlock").attr({x:0,y:0,width:wt,height:l}).attr("transform","translate("+n+","+i+")"),d3.select(this).select(".message-click-active-block").attr({x:-yt,y:-yt,width:2*yt+Math.abs(n-a),height:2*yt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")")}else d3.select(this).remove()}),M(),b()}(J.unfoldUpdateStatus(tt,$))}};var pt=!0;d.prototype.disableFoldAndUnfold=function(){pt=!1,d3.selectAll(".element").each(function(t){t.isGroup()&&d3.select(this).on("click",null)})},d.prototype.enableFoldAndUnfold=function(){pt=!0,d3.selectAll(".element").each(function(t){t.isGroup()&&d3.select(this).on("click",function(t){t.fold?f(t):h(t)})})},d.prototype.addHintByFunc=function(t){var e=$.get(t.from),r=e.x+e.width,a=t.position+40;v(t.from,t.to,t.message,r,a,t.id),d3.selectAll(".message").each(function(e){e==t&&(ht=d3.select(this).select(".message-click-active-block")).style("fill-opacity","0.4")})};var ht,ut=40,gt=8,mt=4,yt=20,vt=10,xt=ut,wt=10,bt=80,Mt=bt/8,kt=90,kt=120,kt=90;A.prototype.sameRepresent=function(t){if(this.represent.length!=t.represent.length)return!1;for(var e=0;e<this.represent.length;e++)if(!this.represent[e].equals(t.represent[e]))return!1;return!0};var At,Lt,Et,Ft,Ot,St,Bt,Gt,Ct,Ht,Dt,Ut,It,Nt,Rt=252,jt=360,Wt=0,Xt=0;S.prototype.isMessageDisplayed=function(t){var e=Lt.getMessages();for(let r of e)if(r.id==t.id)return!0;return!1},S.prototype.locate=function(t,e,r){var[a,o,s,n]=Lt.getIndexByMessageId(t);return-1!=a&&-1!=o&&(C(a,o,s,n,e,r),!0)},S.prototype.getHint=function(){return Lt.getHint()},S.prototype.nearby=function(t){var e=this.getElements(),r=this.getMessages(),a=(Nt.get(t.from),r.indexOf(t)),o=new Set,s=0;for(let t=0;t<50&&!(a+t>=r.length);t++){var n=r[a+t];o.has(n.from)||(o.add(n.from),s+=B(e,s,n.from),s++),o.has(n.to)||(o.add(n.to),s+=B(e,s,n.to),s++)}Lt.updateAfterReOrder(),H(0,Xt),D(),this.locate(t.id,Ot/Ut,St/Ut)},S.prototype.addHint=function(t){Lt.addHintByFunc(t)},S.prototype.getMessages=function(){return Lt.getMessages()},S.prototype.getElements=function(){return Lt.getElements()},S.prototype.getElementMap=function(){return Lt.getElementMap()},S.prototype.getContext=function(){return[Wt,Xt,Et,Ft,Ot/Ut,St/Ut]},S.prototype.resume=function(t){C(t[0],t[1],t[2],t[3],t[4],t[5]),Ut=Ot/t[4]},S.prototype.compress=function(){var t=Lt.getRawMessages(),e=new O(Lt.getMessages()),r=new Set;for(let t of e.result[1])r.add(t.id);var a=[];for(let e of t)r.has(e.id)&&a.push(e);return Lt.setMessages(a),Lt.setLoops(e.result[0]),Lt.disableFoldAndUnfold(),[e.result[0],a]},S.prototype.decompress=function(){this.setLoops([]),Lt.setMessages(this.rawMessageBeforeComress),d3.select(".loop-layout").selectAll("*").remove(),Lt.enableFoldAndUnfold()},S.prototype.setLoops=function(t){Lt.setLoops(t)},S.prototype.resize=function(t,e){Ot=t,St=e,At.attr("width",t).attr("height",e).attr("viewBox",Et+" "+Ft+" "+Ot/Ut+" "+St/Ut),D()},t.SDController=d,t.SDViewer=S,Object.defineProperty(t,"__esModule",{value:!0})});