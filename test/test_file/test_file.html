<!DOCTYPE html>
<meta charset="utf-8">
<body>
    <div id="drawArea"></div>
<script src="../d3.min.js"></script>
<script src="../sd.js"></script>

<script>
var objects;
var messages = [];
var groups = [];
var svg;
d3.csv("object.csv", function(err, data){
    if(err){
        console.log(err);
    }
    else{
        data.forEach(function(obj){
            obj.id = parseInt(obj.id);
            obj.invisible = (obj.invisible == true);
        });
        objects = data;
        console.log("objects load over");
        d3.csv("group.csv", function(err, data){
            if(err){
                console.log(err);
            }
            else{
                data.forEach(function(group){
                    group.id = parseInt(group.id);
                    var objs = group.objs.split("|");
                    group.objs = [];
                    objs.forEach(function(obj){
                        group.objs.push(parseInt(obj));
                    });
                });
                groups = data;
                console.log("groups load over");
                console.log("start read messages");
                d3.csv("message.csv", function(err, data){
                    if(err){
                        console.log(err);
                    }
                    else{
                        var count = 0;
                        data.forEach(function(msg){
                            count++;
                            if(count % 1000 == 0)
                                console.log(count + " messages handled");
                            msg.from = parseInt(msg.from);
                            msg.to = parseInt(msg.to);
                            msg.caller = msg.caller == null ? null : msg.caller;
                            msg.isNew = (msg.isNew == true);
                        });
                        messages = data;
                        console.log("messages load over");
                        svg = new sd.SVG(objects, groups, messages);
                    }
                });
            }
        });
    }
});
/*

*/
</script>
</body>
