!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.name=t.name,this.parent=-1,this.children=[],this.x=0,this.y=0,this.height=f,this.width=this.name.length*u+2*p,this.fold=!0}function n(t,n){var r=new Map;return t.forEach(function(t){t.name=t.name+":"+t.type;var n=new e(t);r.set(n.id,n)}),n.forEach(function(t){var n=new e(t);n.children=t.objs,r.set(n.id,n)}),n.forEach(function(e){t=e.objs;for(var n=0;n<t.length;n++){r.get(t[n]).parent=e.id}}),r}function r(t,e){x=n(t,e),x.forEach(function(t,e,n){-1==t.parent&&w.push(t)}),w.sort(function(t,e){var n=t.id,r=e.id;return t.isGroup()&&(n=t.children[0]),e.isGroup()&&(r=e.children[0]),n-r});for(var r=v,i=0;i<w.length;i++)w[i].x=r,r+=w[i].width+v;this.total=x,this.display=w}function i(t){for(var e=0;e<t.children.length;e++){var n=x.get(t.children[e]);if(n.isGroup()&&!n.fold)return!1}return!0}function a(t){var e=d3.select("svg").append("g"),n=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");return t.isGroup()?n.style("fill","yellow"):n.style("fill","white"),e.append("text").text(function(e){return t.name}).attr("transform","translate("+t.width/2+","+(t.height/2+y)+")").attr("text-anchor","middle"),e.attr("class","element-rectangle").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),t.isGroup()&&e.on("click",function(t){if(t.fold)s(t);else{var e=[];for(e.push(t);0!=e.length;){var n=e[e.length-1];if(i(n))h(n),e.splice(e.length-1,1);else for(var r=0;r<n.children.length;r++){var a=x.get(n.children[r]);a.isGroup()&&(i(a)?h(a):e.push(a))}}}}),e}function s(t){l(t.id),c(t)}function h(t){o(t.id),d(t)}function l(t){var e=x.get(t);if(e.fold){for(var n=e.children,r=m,i=w.indexOf(e)+1,a=0;a<n.length;a++){var s=x.get(n[a]);s.x=r+e.x,w.splice(i,0,s),i++,r+=s.width+v}for(var h=r-v+m-e.width;i<w.length;)w[i].x+=h,i++;e.width+=h,e.y-=m,e.height+=2*m,e.fold=!1;for(var l=e;-1!=l.parent;)l=x.get(l.parent),l.width+=h,l.height+=2*m,l.y-=m}}function o(t){var e=x.get(t);if(!e.fold){for(var n=e.children,r=0,i=0;i<n.length;i++){var a=x.get(n[i]);r=w.indexOf(a),w.splice(r,1)}for(var s=e.width-(e.name.length*g+2*v);r<w.length;)w[r].x-=s,r++;e.width-=s,e.y+=m,e.height-=2*m,e.fold=!0;for(var h=e;-1!=h.parent;)h=x.get(h.parent),h.width-=s,h.height-=2*m,h.y+=m}}function c(t){d3.selectAll(".element-rectangle").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")});for(var e=0;e<t.children.length;e++){var n=t.children[e],r=x.get(n),i=a(r);i.attr("transform","translate("+t.x+", "+(t.y+m)+")"),i.transition().attr("transform","translate("+r.x+", "+r.y+")")}}function d(t){d3.selectAll(".element-rectangle").each(function(e){-1!=t.children.indexOf(e.id)?d3.select(this).remove():e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")})}var f=40,u=10,p=20;e.prototype.isGroup=function(){return 0!=this.children.length};var g=10,y=4,v=20,m=10,x=[],w=[];r.prototype.drawAll=function(){w.forEach(function(t){a(t)})},t.DisplayElements=r,Object.defineProperty(t,"__esModule",{value:!0})});