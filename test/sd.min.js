!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.displayName=t.name,void 0!=t.type&&(this.displayName+=":"+t.type),void 0!=t.displayName&&(this.displayName=t.displayName),this.parent=-1,this.children=[],this.fold=!0,this.x=0,this.y=0,this.height=N,this.width=this.displayName.length*D+2*C}function r(t,r){!function(t,r){R=new Map,U=[],t.forEach(function(t){var r=new e(t);R.set(r.id,r)}),r.forEach(function(r){var a=new e(r);a.children=r.objs,R.set(a.id,a),t=r.objs;for(var s=0;s<t.length;s++)R.get(t[s]).parent=r.id})}(t,r),R.forEach(function(t,e,r){-1==t.parent&&U.push(t)}),U.sort(function(t,e){var r=t.id,a=e.id;return t.isGroup()&&(r=t.children[0]),e.isGroup()&&(a=e.children[0]),r-a});for(var s=H,o=0;o<U.length;o++)U[o].x=s,s+=U[o].width+H;a(),this.display=U,this.elementMap=R,this.displaySet=j}function a(){j=new Set;for(let t of U)t.isGroup()&&!t.fold||j.add(t.id)}function s(t){this.from=t.from,this.to=t.to,this.message=t.message,this.id=t.id,this.count=t.count,this.valid=!1,this.scale=1,this.position=0,this.fromOffset=0,this.toOffset=0}function o(t,e,r,a){W=[],X=new Map,F=[];for(let e of t)F.push(new s(e)),X.set(e.id,{from:e.from,to:e.to});for(let t of F)if(-1!=t.to){for(;!r.has(t.from);){if(void 0==a.get(t.from)){t.from=-1;break}if(-1==(o=a.get(t.from).parent))break;t.from=o}for(;!r.has(t.to);){if(void 0==a.get(t.to)){t.to=-1;break}var o=a.get(t.to).parent;if(-1==o)break;t.to=o}}z=e,n(),this.validMessages=W}function n(){Y=[];for(var t=new Set,e=0;e<F.length;e++){var r=F[e];r.isReturn()?t.has(r.id)&&Y.push(r):r.to!=r.from&&-1!=r.from&&-1!=r.to?(Y.push(r),t.add(r.id)):r.valid=!1}W=[];for(var a=[],s=new i,o=new Map,n=_/4,e=0;e<Y.length;e++){var l=Y[e];if(l.isReturn()){var f=o.get(l.id)[0],d=e-o.get(l.id)[1];n+=_/2,f.scale=(d+1)/2,s.pop()}else o.set(l.id,[l,e]),n+=_/2,l.position=n,s.push(l),l.fromOffset=s.getOffset(l.from),l.toOffset=s.getOffset(l.to),r.valid||a.push(r),l.valid=!0,W.push(l)}for(var h=Y.length;!s.isEmpty();){var c=s.pop(),d=h-o.get(c.id)[1];n+=_/2,c.scale=(d+1)/2,h++}return a}function i(){this.stack=[],this.offset=new Map;for(let t of z)this.offset.set(t,0)}function l(t,e,a){T=new r(t,e),J=T.elementMap,V=T.display,K=T.displaySet;for(var s=new Set([0]),n=J.get(0);-1!=n.parent;)s.add(n.parent),n=J.get(n.parent);P=[0],q=new o(a,s,K,J),Q=q.validMessages,p()}function f(t){T.unfoldUpdateStatus(t.id),function(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?(d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")").style("opacity",0)):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))}),V.forEach(function(t){dt=Math.max(dt,t.height)});for(var r=0;r<t.children.length;r++){var a=t.children[r],s=J.get(a),o=u(s);o.attr("transform","translate("+t.x+", "+(t.y+ft)+")"),o.transition().attr("transform","translate("+s.x+", "+s.y+")"),d3.select("#baseLine"+a).transition().attr("transform","translate("+s.x+", "+s.y+")")}}(t);y(q.unfoldUpdateStatus(K,J)),c()}function d(t){T.foldUpdateStatus(t.id),function(t,e){d3.selectAll(".element").each(function(e){-1!=t.children.indexOf(e.id)?(d3.select("#baseLine"+e.id).remove(),d3.select(this).remove()):e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),dt=Math.max(dt,e.height),e==t?(d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().style("opacity",1).attr("transform","translate("+e.x+", "+e.y+")")):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).transition().attr("transform","translate("+e.x+", "+e.y+")"))}),dt=ot,V.forEach(function(t){dt=Math.max(dt,t.height)})}(t),q.unfoldUpdateStatus(K,J),y([]),c()}function h(t){for(var e=0;e<t.children.length;e++){var r=J.get(t.children[e]);if(r.isGroup()&&!r.fold)return!1}return!0}function c(){for(var t=0,e=et;e<et+$&&!(e>=V.length);e++)t=Math.min(V[e].y,t);var r=parseInt(d3.select(".objects-layout").attr("transform").split(/,|\)/)[1]);void 0==l.prototype.top?(d3.select(".objects-layout").attr("transform","translate(0,"+(r-t)+")"),l.prototype.top=t):l.prototype.top!=t&&(d3.select(".objects-layout").attr("transform","translate(0,"+(r+l.prototype.top-t)+")"),l.prototype.top=t)}function p(){d3.select("svg").append("g").attr("class","baseline-layout"),d3.select("svg").append("g").attr("class","loop-layout"),d3.select("svg").append("g").attr("class","mainthread-layout"),d3.select("svg").append("g").attr("class","messages-layout"),d3.select("svg").append("g").attr("class","objects-layout").attr("transform","translate(0, 0)")}function u(t){var e=d3.select(".objects-layout").append("g"),r=t.width/2,a=(at&&rt+tt<Q.length?tt:Q.length)*ct+ot+ct/2;d3.select(".baseline-layout").append("line").attr("class","baseLine").attr("x1",r).attr("y1",0).attr("x2",r).attr("y2",a).style("stroke","black").style("stroke-dasharray","2,2,2").attr("id","baseLine"+t.id).attr("transform","translate("+t.x+", "+t.y+")");var s=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");return t.isGroup()?s.style("fill","yellow"):s.style("fill","white"),e.append("text").text(function(e){return t.displayName}).attr("transform","translate("+t.width/2+","+(t.height/2+it)+")").attr("text-anchor","middle"),e.attr("class","element").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),t.isGroup()&&e.on("click",function(t){t.fold?f(t):function(t){var e=[];for(e.push(t);0!=e.length;){var r=e[e.length-1];if(h(r))d(r),e.splice(e.length-1,1);else for(var a=0;a<r.children.length;a++){var s=J.get(r.children[a]);s.isGroup()&&(h(s)?d(s):e.push(s))}}}(t)}),e}function g(t){var e=J.get(t.from),r=J.get(t.to),a=e.x+e.width/2-ht/2+t.fromOffset*ht,s=t.position+pt,o=t.scale*ct-2*pt,n=r.x+r.width/2-ht/2+t.toOffset*ht,i=s+pt,l=o-2*pt;if(at){var f=et>0?V[et-1].x:V[0].x,d=et+$;d>=V.length&&(d=V.length-1);var h=V[d].x+V[d].width;a<f&&(a=f),n>h&&(n=h)}var c=J.get(t.from).x<J.get(t.to).x,p=d3.select(".messages-layout").append("g"),u=p.append("text").attr("class","message-text").text(function(e){return t.message});c?u.attr("transform","translate("+(a+lt)+","+s+")"):u.attr("transform","translate("+(a-ht)+","+s+")").attr("text-anchor","end"),p.append("line").attr("class","callLine").style("stroke","black").attr("x1",c?a+ht:a).attr("y1",i).attr("x2",c?n:n+ht).attr("y2",i).attr("marker-end","url(#end)"),p.append("line").attr("class","callBackLine").style("stroke","black").style("stroke-dasharray","5, 5, 5").attr("x1",c?n:n+ht).attr("y1",i+l).attr("x2",c?a+ht:a).attr("y2",i+l).attr("marker-end","url(#end)"),p.append("rect").attr("class","rightActiveBlock").attr({x:0,y:0,width:ht,height:l}).attr("transform","translate("+n+","+i+")").style("stroke","black").style("fill","#CCC"),p.attr("class","message").datum(t),p.append("rect").attr("class","message-click-active-block").attr({x:-lt,y:-lt,width:2*lt+Math.abs(n-a),height:2*lt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")").style("fill","#99ccff").style("fill-opacity","0").datum(t.id),p.attr("class","message").datum(t).on("dblclick",function(e){var r=d3.select(this).select(".message-click-active-block");if(void 0!=st)if(st.style("fill-opacity","0"),st.datum()!=r.datum()){r.style("fill-opacity","0.4"),st=r;var a=d3.mouse(this)[0],s=d3.mouse(this)[1];d3.select(".hint-box").remove(),m(t.from,t.to,t.message,a,s)}else st=void 0,d3.select(".hint-box").remove();else{r.style("fill-opacity","0.4"),st=r;var a=d3.mouse(this)[0],s=d3.mouse(this)[1];m(t.from,t.to,t.message,a,s)}})}function m(t,e,r,a,s){var o=d3.select("svg").append("g").attr("class","hint-box"),n=J.get(t).displayName,i=J.get(e).displayName,l=1,f=d3.select("svg");if(null!=f[0][0]){f=f.attr("viewBox");var d=window.innerWidth;l=f.split(" ")[2]/d}var h=(Math.max(n.length,i.length,r.length)+8)*nt+2*lt;o.append("rect").attr({x:0,y:0,width:h,height:ut}).style("fill","#FEF8DE").style("stroke","black"),o.append("text").text(function(t){return"Caller: "+n}).attr("transform","translate("+lt+","+(ut/6+it)+")").style("font-family","Courier New"),o.append("text").text(function(t){return"Callee: "+i}).attr("transform","translate("+lt+","+(ut/2+it)+")").style("font-family","Courier New"),o.append("text").text(function(t){return"Method: "+r}).attr("transform","translate("+lt+","+(ut/6*5+it)+")").style("font-family","Courier New"),o.attr("transform","translate("+a+","+s+") scale("+l+")")}function y(t){for(let e of t)e.valid&&g(e);d3.selectAll(".message").each(function(t){if(t.valid){var e=J.get(t.from),r=J.get(t.to),a=e.x+e.width/2-ht/2+t.fromOffset*ht,s=t.position+pt,o=t.scale*ct-2*pt,n=r.x+r.width/2-ht/2+t.toOffset*ht,i=s+pt,l=o-2*pt,f=J.get(t.from).x<J.get(t.to).x;f?d3.select(this).select(".message-text").transition().attr("transform","translate("+(a+lt)+","+s+")"):d3.select(this).select(".message-text").transition().attr("transform","translate("+(a-ht)+","+s+")"),d3.select(this).select(".callLine").transition().attr("x1",f?a+ht:a).attr("y1",i).attr("x2",f?n:n+ht).attr("y2",i),d3.select(this).select(".callBackLine").transition().attr("x1",f?n:n+ht).attr("y1",i+l).attr("x2",f?a+ht:a).attr("y2",i+l),d3.select(this).select(".rightActiveBlock").transition().attr({x:0,y:0,width:ht,height:l}).attr("transform","translate("+n+","+i+")"),d3.select(this).select(".message-click-active-block").transition().attr({x:-lt,y:-lt,width:2*lt+Math.abs(n-a),height:2*lt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")")}else d3.select(this).remove()});var e=(at&&rt+tt<Q.length?tt:Q.length)*ct+ot+ct/2;d3.selectAll(".baseLine").attr("y2",e),x()}function v(){for(let s of P){for(var t=J.get(s);!K.has(t.id)&&-1!=t.parent;)t=J.get(t.parent);var e=t.x+t.width/2-ht/2,r=.75*ct,a=Q.length*ct;d3.select(".mainthread-layout").append("rect").attr("class","mainThreadActiveBar").attr({x:0,y:0,width:ht,height:a}).attr("transform","translate("+e+","+r+")").style("stroke","black").style("fill","#CCC")}}function x(){d3.selectAll(".mainThreadActiveBar").remove(),v()}function w(){d3.select(".loop-layout").remove(),d3.select("svg").append("g").attr("class","loop-layout");var t=new Map;for(let e of Q)t.set(e.id,e);for(let p of Z){var e=p.represent,r=Number.MAX_SAFE_INTEGER,a=0,s=void 0;for(let h of e){var o=t.get(h.id);void 0==s&&(s=o);var n=J.get(o.from),i=J.get(o.to),l=n.x+n.width/2,f=i.x+i.width/2;if(l>f){d=l;l=f,f=d}f+=60,(l-=60)<r&&(r=l),f>a&&(a=f)}var d,h=s.position-10,c=e.length*ct;(d=d3.select(".loop-layout").append("g")).append("rect").attr({x:0,y:0,width:a-r,height:c}).style("stroke","blue").style("fill-opacity","0"),d.append("rect").attr({x:0,y:0,width:45,height:20}).style("stroke","blue").style("fill-opacity","0"),d.append("text").text(function(t){return"loop"}).attr("transform","translate(4, 16)"),d.attr("transform","translate("+r+","+h+")")}}function M(t,e){this.represent=t,this.repeat=e,this.children=[],this.depth=1}function b(t,e,r){for(var a=e;a<e+r;a++)if(!t[a].sameRepresent(t[a+r]))return!1;return!0}function k(t,e,r,a){for(var s=[],o=[],n=0,i=e;i<e+r;i++)s=s.concat(t[i].represent),o.push(t[i]),t[i].depth>n&&(n=t[i].depth);var l=new M(s,a);return l.children=o,l.depth=n+1,l}function E(t){var e=[];if(0==t.children.length)return e;var r=[];for(r.push(t);0!=r.length;){var a=r.pop();e.push(a);for(var s=0;s<a.children.length;s++)a.children[s].repeat>1&&r.push(a.children[s])}return e}function L(t){for(var e=function(t){for(var e=[],r=0;r<t.length;r++)e.push(new M([t[r]],1));for(var a=1,s=100>e.length/2?e.length/2:100;a<=s;){for(r=0;r<=e.length-2*a;r++){for(var o=1;b(e,r,a)&&(e.splice(r+a,a),o++,!(r>e.length-2*a)););if(o>1){var n=k(e,r,a,o);e.splice(r,a,n)}}a++}return e}(t),r=[],a=[],s=0;s<e.length;s++)r=r.concat(E(e[s])),a=a.concat(e[s].represent);this.result=[r,a]}function S(t,e,r){xt=window.innerWidth,wt=window.innerHeight-100,St=1,yt=-10,vt=-10,d3.select("svg").remove(),(gt=d3.select("#drawArea").append("svg").attr("width",xt).attr("height",wt).call(d3.behavior.zoom().scaleExtent([.2,10]).on("zoom",function(){if(St!==d3.event.scale){var t=St/d3.event.scale;St=d3.event.scale,yt=Mt-t*(Mt-yt),vt=Math.max(bt-t*(bt-vt),2*mt.top),gt.attr("viewBox",yt+" "+vt+" "+xt/St+" "+wt/St);var e=d3.select(".hint-box");if(null!=e[0][0]){var r=e.attr("transform").split(" ");e.attr("transform",r[0]+" scale("+1/St+")")}O()}}))).on("dblclick.zoom",null),gt.on("mousedown",function(){Lt=!0,kt=d3.mouse(this)[0],Et=d3.mouse(this)[1]}),gt.on("mouseup",function(){Lt=!1,yt=yt-d3.mouse(this)[0]+kt,vt=Math.max(vt-d3.mouse(this)[1]+Et,2*mt.top),gt.attr("viewBox",yt+" "+vt+" "+xt/St+" "+wt/St),O()}),gt.on("mousemove",function(){Mt=d3.mouse(this)[0],bt=d3.mouse(this)[1],Lt&&(yt=yt-d3.mouse(this)[0]+kt,vt=Math.max(vt-d3.mouse(this)[1]+Et,2*mt.top),gt.attr("viewBox",yt+" "+vt+" "+xt/St+" "+wt/St),O())}),gt.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5"),(mt=new l(t,e,r)).setDiagramSize(Bt,Gt),mt.setDiagramDisplayHead(It,Nt),mt.drawWindow(),At=mt.getElementSet(),Ot=mt.getElementMap()}function A(t,e){for(var r=e.id;e.isGroup();)e=Ot.get(e.children[0]);e.id=t;for(var a=Ot.get(t);a.isGroup();)a=Ot.get(a.children[0]);a.id=r}function O(){if(-1!=mt.getMiddleElementX()&&yt>=mt.getMiddleElementX()&&G(mt.getMiddleElementIndex(),Nt),It>0&&yt<=mt.getHeadElementX()){(t=It-Bt/2)<0&&(t=0),G(t,Nt)}if(-1!=mt.getMiddleMessageY()&&vt>=mt.getMiddleMessageY()&&G(It,mt.getMiddleMessageIndex()),Nt>0&&vt<=mt.getHeadMessageY()){var t=Nt-Gt/2;t<0&&(t=0),G(It,t)}I()}function B(t,e,r,a,s,o){It=Math.max(t-Bt/2,0),Nt=Math.max(e-Gt/2,0),G(It,Nt),yt=r,vt=a,gt.attr("viewBox",yt+" "+vt+" "+s+" "+o),I()}function G(t,e){mt.clearAll(),It=t,Nt=e,mt.setDiagramDisplayHead(t,e),mt.drawWindow()}function I(){d3.select(".objects-layout").attr("transform","translate(0,"+(vt-mt.top)+")"),d3.select(".baseline-layout").attr("transform","translate(0,"+(vt-mt.top)+")")}var N=40,D=10,C=20;e.prototype.isGroup=function(){return 0!=this.children.length};var j,H=20,R=[],U=[];r.prototype.getGroupFoldInfo=function(){var t=new Set;for(let e of U)e.isGroup()&&!e.fold&&t.add(e.id);return t},r.prototype.unfoldUpdateStatus=function(t){var e=R.get(t);if(e.fold){for(var r=e.children,s=10,o=U.indexOf(e)+1,n=0;n<r.length;n++){var i=R.get(r[n]);i.x=s+e.x,U.splice(o,0,i),o++,s+=i.width+H}for(var l=s-H+10-e.width;o<U.length;)U[o].x+=l,o++;e.width+=l,e.y-=10,e.height+=20,e.fold=!1;for(var f=e;-1!=f.parent;)(f=R.get(f.parent)).width+=l,f.height+=20,f.y-=10;a()}},r.prototype.foldUpdateStatus=function(t){var e=R.get(t);if(!e.fold){for(var r=e.children,s=0,o=0;o<r.length;o++){var n=R.get(r[o]);s=U.indexOf(n),U.splice(s,1)}for(var i=e.width-(10*e.displayName.length+2*H);s<U.length;)U[s].x-=i,s++;e.width-=i,e.y+=10,e.height-=20,e.fold=!0;for(var l=e;-1!=l.parent;)(l=R.get(l.parent)).width-=i,l.height-=20,l.y+=10;a()}},s.prototype.equals=function(t){return this.from==t.from&&this.to==t.to&&this.message==t.message},s.prototype.isReturn=function(){return-1==this.to&&0==this.message.length};var W,X,F,Y,z,_=80;o.prototype.foldUpdateStatus=function(t){for(let e of F)-1!=e.to&&(-1!=t.children.indexOf(e.from)&&(e.from=t.id),-1!=t.children.indexOf(e.to)&&(e.to=t.id));n()},o.prototype.getRawMessages=function(){return Y},o.prototype.unfoldUpdateStatus=function(t,e){for(let a of F)if(-1!=a.to&&-1!=a.from){if(!t.has(a.from))for(a.from=X.get(a.id).from;!t.has(a.from);){if(-1==(r=e.get(a.from).parent))break;a.from=r}if(!t.has(a.to))for(a.to=X.get(a.id).to;!t.has(a.to);){var r=e.get(a.to).parent;if(-1==r)break;a.to=r}}return n()},i.prototype.push=function(t){this.stack.push(t),this.offset.has(t.to)?this.offset.set(t.to,this.offset.get(t.to)+1):this.offset.set(t.to,0)},i.prototype.pop=function(){var t=this.stack.pop(),e=this.offset.get(t.to)-1;return e<0?this.offset.delete(t.to):this.offset.set(t.to,e),t},i.prototype.peek=function(){return this.stack[this.stack.length-1]},i.prototype.hasActive=function(t){return this.offset.has(t)},i.prototype.isEmpty=function(){return 0==this.stack.length},i.prototype.getOffset=function(t){return this.offset.has(t)?this.offset.get(t):0};var T,q,P,V,J,K,Q,Z;l.prototype.draw=function(){p();for(var t=0;t<V.length;t++)u(V[t]);v();for(let t of Q)g(t)},l.prototype.getMessages=function(){return Q},l.prototype.getElementSet=function(){return K},l.prototype.getElements=function(){return V},l.prototype.getElementMap=function(){return J},l.prototype.getRawMessages=function(){return q.getRawMessages()},l.prototype.setLoops=function(t){Z=t,w()};var $,tt,et,rt,at=!1;l.prototype.setDiagramSize=function(t,e){$=t,tt=e,at=!0,this.setDiagramDisplayHead(0,0)},l.prototype.setDiagramDisplayHead=function(t,e){et=t,rt=e},l.prototype.getMiddleElementIndex=function(){return et+$/2},l.prototype.getMiddleElementX=function(){var t=this.getMiddleElementIndex();return t<V.length?V[t].x:-1},l.prototype.getHeadElementX=function(){return V[et].x},l.prototype.getMiddleMessageIndex=function(){return rt+tt/2},l.prototype.getMiddleMessageY=function(){var t=this.getMiddleMessageIndex();return t<Q.length?Q[t].position:-1},l.prototype.getHeadMessageY=function(){return Q[rt].position},l.prototype.getIndexByMessageId=function(t){for(var e=-1,r=-1,a=-1,s=-1,o=0;o<Q.length;o++)if(Q[o].id==t){r=o,s=Q[o].position;break}if(-1!=r)for(var n=0;n<V.length;n++)if(V[n].id==Q[r].from){e=n,a=V[n].x;break}return[e,r,a,s-60]},l.prototype.drawWindow=function(){for(t=et;t<et+$&&!(t>=V.length);t++)u(V[t]);c(),v();for(var t=rt;t<rt+tt&&!(t>=Q.length);t++)g(Q[t])},l.prototype.clearAll=function(){d3.select(".messages-layout").remove(),d3.select(".objects-layout").remove(),d3.select(".loop-layout").remove(),d3.select(".mainthread-layout").remove(),d3.select(".baseline-layout").remove(),p()},l.prototype.getFoldInfo=function(){return T.getGroupFoldInfo()},l.prototype.updateWithoutAnimation=function(t){for(let e of V)if(t.has(e.id)){T.unfoldUpdateStatus(group.id),function(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").attr({width:e.width,height:e.height}),e==t?(d3.select(this).style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")").style("opacity",0)):(d3.select(this).attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")"))):(d3.select(this).attr("transform","translate("+e.x+", "+e.y+")"),d3.select("#baseLine"+e.id).attr("transform","translate("+e.x+", "+e.y+")"))}),V.forEach(function(t){dt=Math.max(dt,t.height)});for(var r=0;r<t.children.length;r++){var a=t.children[r],s=J.get(a),o=u(s);o.attr("transform","translate("+t.x+", "+(t.y+ft)+")"),o.attr("transform","translate("+s.x+", "+s.y+")"),d3.select("#baseLine"+a).attr("transform","translate("+s.x+", "+s.y+")")}}(group);!function(t){for(let e of t)e.valid&&g(e);d3.selectAll(".message").each(function(t){if(t.valid){var e=J.get(t.from),r=J.get(t.to),a=e.x+e.width/2-ht/2+t.fromOffset*ht,s=t.position+pt,o=t.scale*ct-2*pt,n=r.x+r.width/2-ht/2+t.toOffset*ht,i=s+pt,l=o-2*pt,f=J.get(t.from).x<J.get(t.to).x;f?d3.select(this).select(".message-text").attr("transform","translate("+(a+lt)+","+s+")"):d3.select(this).select(".message-text").attr("transform","translate("+(a-ht)+","+s+")"),d3.select(this).select(".callLine").attr("x1",f?a+ht:a).attr("y1",i).attr("x2",f?n:n+ht).attr("y2",i),d3.select(this).select(".callBackLine").attr("x1",f?n:n+ht).attr("y1",i+l).attr("x2",f?a+ht:a).attr("y2",i+l),d3.select(this).select(".rightActiveBlock").attr({x:0,y:0,width:ht,height:l}).attr("transform","translate("+n+","+i+")"),d3.select(this).select(".message-click-active-block").attr({x:-lt,y:-lt,width:2*lt+Math.abs(n-a),height:2*lt+l}).attr("transform","translate("+Math.min(a,n)+","+i+")")}else d3.select(this).remove()});var e=(at&&rt+tt<Q.length?tt:Q.length)*ct+ot+ct;d3.selectAll(".baseLine").attr("y2",e),x()}(q.unfoldUpdateStatus(K,J))}};var st,ot=40,nt=10,it=4,lt=20,ft=10,dt=ot,ht=10,ct=80,pt=ct/8,ut=90,ut=90;M.prototype.sameRepresent=function(t){if(this.represent.length!=t.represent.length)return!1;for(var e=0;e<this.represent.length;e++)if(!this.represent[e].equals(t.represent[e]))return!1;return!0};var gt,mt,yt,vt,xt,wt,Mt,bt,kt,Et,Lt,St,At,Ot,Bt=252,Gt=360,It=0,Nt=0;S.prototype.isMessageDisplayed=function(t){for(;!At.has(t.from);){if(void 0==Ot.get(t.from))return!1;if(-1==(e=Ot.get(t.from).parent))break;t.from=e}for(;!At.has(t.to);){if(void 0==Ot.get(t.to))return!1;var e=Ot.get(t.to).parent;if(-1==e)break;t.to=e}return!(t.from==t.to||-1==t.from||-1==t.to)},S.prototype.locate=function(t,e,r){var[a,s,o,n]=mt.getIndexByMessageId(t);return-1!=a&&-1!=s&&(B(a,s,o,n,e,r),!0)},S.prototype.showNearBy=function(t){var[e,r,a,s]=mt.getIndexByMessageId(t),o=this.getElements(),n=this.getMessages(),i=e-1,l=e+1,f=new Set;f.add(e);for(var d=0;d<100;d++){if(r-d>=0){var h=n[r-d];f.has(h.from)||(h.from>e?(A(h.from,o[i]),i--):(A(h.from,o[l]),l++),f.add(h.from)),f.has(h.to)||(h.to>e?(A(h.to,o[i]),i--):(A(h.to,o[l]),l++),f.add(h.to))}if(r+d<n.length){var c=n[r+d];f.has(c.from)||(c.from>e?(A(c.from,o[i]),i--):(A(c.from,o[l]),l++),f.add(c.from)),f.has(c.to)||(c.to>e?(A(c.to,o[i]),i--):(A(c.to,o[l]),l++),f.add(c.to))}}var p=[];for(let t in o)t.isGroup()||p.push(t);return p},S.prototype.getMessages=function(){return mt.getMessages()},S.prototype.getElements=function(){return mt.getElements()},S.prototype.getElementMap=function(){return mt.getElementMap()},S.prototype.getContext=function(){return[It,Nt,yt,vt,xt/St,wt/St]},S.prototype.resume=function(t){B(t[0],t[1],t[2],t[3],t[4],t[5]),St=xt/t[4]},S.prototype.compress=function(){var t=mt.getRawMessages(),e=new L(mt.getMessages()),r=new Set;for(let t of e.result[1])r.add(t.id);var a=[];for(let e of t)r.has(e.id)&&a.push(e);return[e.result[0],a]},S.prototype.setLoops=function(t){mt.setLoops(t)},t.SDController=l,t.SDViewer=S,Object.defineProperty(t,"__esModule",{value:!0})});