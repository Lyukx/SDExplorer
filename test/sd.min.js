!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.name=t.name,this.parent=-1,this.children=[],this.x=0,this.y=0,this.height=f,this.width=this.name.length*c+2*u,this.fold=!0}function n(t,n){var r=new Map;return t.forEach(function(t){t.name=t.name+":"+t.type;var n=new e(t);r.set(n.id,n)}),n.forEach(function(t){var n=new e(t);n.children=t.objs,r.set(n.id,n)}),n.forEach(function(e){t=e.objs;for(var n=0;n<t.length;n++){r.get(t[n]).parent=e.id}}),r}function r(t,e){g=n(t,e),g.forEach(function(t,e,n){-1==t.parent&&y.push(t)}),y.sort(function(t,e){var n=t.id,r=e.id;return t.isGroup()&&(n=t.children[0]),e.isGroup()&&(r=e.children[0]),n-r});for(var r=p,i=0;i<y.length;i++)y[i].x=r,r+=y[i].width+p;this.total=g,this.display=y}function i(t,e){var n=new r(t,e);v=n,w=n.total,G=n.display}function a(t){v.unfoldUpdateStatus(t.id),h(t)}function o(t){v.foldUpdateStatus(t.id),d(t)}function s(t){for(var e=0;e<t.children.length;e++){var n=w.get(t.children[e]);if(n.isGroup()&&!n.fold)return!1}return!0}function l(t){var e=d3.select("svg").append("g"),n=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");return t.isGroup()?n.style("fill","yellow"):n.style("fill","white"),e.append("text").text(function(e){return t.name}).attr("transform","translate("+t.width/2+","+(t.height/2+m)+")").attr("text-anchor","middle"),e.attr("class","element-rectangle").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),t.isGroup()&&e.on("click",function(t){if(t.fold)a(t);else{var e=[];for(e.push(t);0!=e.length;){var n=e[e.length-1];if(s(n))o(n),e.splice(e.length-1,1);else for(var r=0;r<n.children.length;r++){var i=w.get(n.children[r]);i.isGroup()&&(s(i)?o(i):e.push(i))}}}}),e}function h(t){d3.selectAll(".element-rectangle").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")});for(var e=0;e<t.children.length;e++){var n=t.children[e],r=w.get(n),i=l(r);i.attr("transform","translate("+t.x+", "+(t.y+x)+")"),i.transition().attr("transform","translate("+r.x+", "+r.y+")")}}function d(t){d3.selectAll(".element-rectangle").each(function(e){-1!=t.children.indexOf(e.id)?d3.select(this).remove():e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")})}var f=40,c=10,u=20;e.prototype.isGroup=function(){return 0!=this.children.length};var p=20,g=[],y=[];r.prototype.unfoldUpdateStatus=function(t){var e=g.get(t);if(e.fold){for(var n=e.children,r=10,i=y.indexOf(e)+1,a=0;a<n.length;a++){var o=g.get(n[a]);o.x=r+e.x,y.splice(i,0,o),i++,r+=o.width+p}for(var s=r-p+10-e.width;i<y.length;)y[i].x+=s,i++;e.width+=s,e.y-=10,e.height+=20,e.fold=!1;for(var l=e;-1!=l.parent;)l=g.get(l.parent),l.width+=s,l.height+=20,l.y-=10}},r.prototype.foldUpdateStatus=function(t){var e=g.get(t);if(!e.fold){for(var n=e.children,r=0,i=0;i<n.length;i++){var a=g.get(n[i]);r=y.indexOf(a),y.splice(r,1)}for(var o=e.width-(10*e.name.length+2*p);r<y.length;)y[r].x-=o,r++;e.width-=o,e.y+=10,e.height-=20,e.fold=!0;for(var s=e;-1!=s.parent;)s=g.get(s.parent),s.width-=o,s.height-=20,s.y+=10}};var v,m=4,x=10,w=[],G=[];i.prototype.drawAll=function(){G.forEach(function(t){l(t)})},t.SDViewer=i,Object.defineProperty(t,"__esModule",{value:!0})});