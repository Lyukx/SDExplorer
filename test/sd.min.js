!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.displayName=t.name,void 0!=t.type&&(this.displayName+=t.type),this.parent=-1,this.children=[],this.fold=!0,this.x=0,this.y=0,this.height=u,this.width=this.displayName.length*g+2*y}function r(t,r){m=new Map,t.forEach(function(t){var r=new e(t);m.set(r.id,r)}),r.forEach(function(r){var n=new e(r);n.children=r.objs,m.set(n.id,n),t=r.objs;for(var i=0;i<t.length;i++){m.get(t[i]).parent=r.id}})}function n(t,e){r(t,e),m.forEach(function(t,e,r){-1==t.parent&&x.push(t)}),x.sort(function(t,e){var r=t.id,n=e.id;return t.isGroup()&&(r=t.children[0]),e.isGroup()&&(n=e.children[0]),r-n});for(var n=v,i=0;i<x.length;i++)x[i].x=n,n+=x[i].width+v}function i(t,e){this.represent=t,this.repeat=e,this.children=[],this.depth=1}function a(){d3.select("svg").append("g").attr("class","baseline-layout"),d3.select("svg").append("g").attr("class","loop-layout"),d3.select("svg").append("g").attr("class","messages-layout"),d3.select("svg").append("g").attr("class","objects-layout").attr("transform","translate(0, 0)")}function s(t){var e=d3.select(".objects-layout").append("g"),r=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");return t.isGroup()?r.style("fill","yellow"):r.style("fill","white"),e.append("text").text(function(e){return t.displayName}).attr("transform","translate("+t.width/2+","+(t.height/2+E)+")").attr("text-anchor","middle"),e.attr("class","element").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),e}function o(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")}),e.getDisplay().forEach(function(t){M=Math.max(M,t.height)});for(var r=e.getElementMap(),n=0;n<t.children.length;n++){var i=t.children[n],a=r.get(i),o=s(a);o.attr("transform","translate("+t.x+", "+(t.y+G)+")"),o.transition().attr("transform","translate("+a.x+", "+a.y+")")}}function l(t,e){d3.selectAll(".element-rectangle").each(function(e){-1!=t.children.indexOf(e.id)?(d3.select("#baseLine"+e.id).remove(),d3.select(this).remove()):e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),M=Math.max(M,e.height),e==t?d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")}),M=b,e.getDisplay().forEach(function(t){M=Math.max(M,t.height)})}function h(t,e,r){w=new n(t,e)}function d(t){w.unfoldUpdateStatus(t.id),o(t,w)}function c(t){w.foldUpdateStatus(t.id),l(groups,w)}function f(t){for(var e=0;e<t.children.length;e++){var r=w.getElementMap().get(t.children[e]);if(r.isGroup()&&!r.fold)return!1}return!0}function p(t){var e=[];for(e.push(t);0!=e.length;){var r=e[e.length-1];if(f(r))c(r),e.splice(e.length-1,1);else for(var n=0;n<r.children.length;n++){var i=w.getElementMap().get(r.children[n]);i.isGroup()&&(f(i)?c(i):e.push(i))}}}var u=40,g=10,y=20;e.prototype.isGroup=function(){return 0!=this.children.length};var v=20,m=[],x=[];n.prototype.getElementMap=function(){return m},n.prototype.getDisplay=function(){return x},n.prototype.unfoldUpdateStatus=function(t){var e=m.get(t);if(e.fold){for(var r=e.children,n=10,i=x.indexOf(e)+1,a=0;a<r.length;a++){var s=m.get(r[a]);s.x=n+e.x,x.splice(i,0,s),i++,n+=s.width+v}for(var o=n-v+10-e.width;i<x.length;)x[i].x+=o,i++;e.width+=o,e.y-=10,e.height+=20,e.fold=!1;for(var l=e;-1!=l.parent;)l=m.get(l.parent),l.width+=o,l.height+=20,l.y-=10}},n.prototype.foldUpdateStatus=function(t){var e=m.get(t);if(!e.fold){for(var r=e.children,n=0,i=0;i<r.length;i++){var a=m.get(r[i]);n=x.indexOf(a),x.splice(n,1)}for(var s=e.width-(10*e.displayName.length+2*v);n<x.length;)x[n].x-=s,n++;e.width-=s,e.y+=10,e.height-=20,e.fold=!0;for(var o=e;-1!=o.parent;)o=m.get(o.parent),o.width-=s,o.height-=20,o.y+=10}},i.prototype.sameRepresent=function(t){if(this.represent.length!=t.represent.length)return!1;for(var e=0;e<this.represent.length;e++)if(!this.represent[e].equals(t.represent[e]))return!1;return!0};var w,b=40,E=4,G=10,M=b;h.prototype.draw=function(){a();for(var t=w.getDisplay(),e=0;e<t.length;e++){var r=s(t[e]);t[e].isGroup()&&r.on("click",function(t){t.fold?d(t):p(t)})}},t.SDController=h,Object.defineProperty(t,"__esModule",{value:!0})});