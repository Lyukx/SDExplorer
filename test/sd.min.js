!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sd={})}(this,function(t){"use strict";function e(t){this.id=t.id,this.displayName=t.name,void 0!=t.type&&(this.displayName+=t.type),this.parent=-1,this.children=[],this.fold=!0,this.x=0,this.y=0,this.height=u,this.width=this.displayName.length*g+2*y}function n(t,n){m=new Map,t.forEach(function(t){var n=new e(t);m.set(n.id,n)}),n.forEach(function(n){var r=new e(n);r.children=n.objs,m.set(r.id,r),t=n.objs;for(var i=0;i<t.length;i++){m.get(t[i]).parent=n.id}})}function r(t,e){n(t,e),m.forEach(function(t,e,n){-1==t.parent&&x.push(t)}),x.sort(function(t,e){var n=t.id,r=e.id;return t.isGroup()&&(n=t.children[0]),e.isGroup()&&(r=e.children[0]),n-r});for(var r=v,i=0;i<x.length;i++)x[i].x=r,r+=x[i].width+v}function i(t,e){this.represent=t,this.repeat=e,this.children=[],this.depth=1}function a(t,e,n){w=new r(t,e)}function s(t){w.unfoldUpdateStatus(t.id),f(t,w)}function o(t){w.foldUpdateStatus(t.id),p(t,w)}function l(t){for(var e=0;e<t.children.length;e++){var n=w.getElementMap().get(t.children[e]);if(n.isGroup()&&!n.fold)return!1}return!0}function h(t){var e=[];for(e.push(t);0!=e.length;){var n=e[e.length-1];if(l(n))o(n),e.splice(e.length-1,1);else for(var r=0;r<n.children.length;r++){var i=w.getElementMap().get(n.children[r]);i.isGroup()&&(l(i)?o(i):e.push(i))}}}function d(t){var e=d3.select(".objects-layout").append("g"),n=e.append("rect").attr({x:0,y:0,width:t.width,height:t.height}).style("stroke","black");return t.isGroup()?n.style("fill","yellow"):n.style("fill","white"),e.append("text").text(function(e){return t.displayName}).attr("transform","translate("+t.width/2+","+(t.height/2+G)+")").attr("text-anchor","middle"),e.attr("class","element").datum(t).attr("transform","translate("+t.x+", "+t.y+")"),t.isGroup()&&e.on("click",function(t){t.fold?s(t):h(t)}),e}function c(){d3.select("svg").append("g").attr("class","baseline-layout"),d3.select("svg").append("g").attr("class","loop-layout"),d3.select("svg").append("g").attr("class","messages-layout"),d3.select("svg").append("g").attr("class","objects-layout").attr("transform","translate(0, 0)")}function f(t,e){d3.selectAll(".element").each(function(e){e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),e==t?d3.select(this).transition().style("fill-opacity","0").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")}),e.getDisplay().forEach(function(t){b=Math.max(b,t.height)});for(var n=e.getElementMap(),r=0;r<t.children.length;r++){var i=t.children[r],a=n.get(i),s=d(a);s.attr("transform","translate("+t.x+", "+(t.y+M)+")"),s.transition().attr("transform","translate("+a.x+", "+a.y+")")}}function p(t,e){d3.selectAll(".element").each(function(e){console.log(t),console.log(e.id),-1!=t.children.indexOf(e.id)?d3.select(this).remove():e.isGroup()?(d3.select(this).select("rect").transition().attr({width:e.width,height:e.height}),b=Math.max(b,e.height),e==t?d3.select(this).transition().style("fill-opacity","1").attr("transform","translate("+e.x+", "+e.y+")"):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")):d3.select(this).transition().attr("transform","translate("+e.x+", "+e.y+")")}),b=E,e.getDisplay().forEach(function(t){b=Math.max(b,t.height)})}var u=40,g=10,y=20;e.prototype.isGroup=function(){return 0!=this.children.length};var v=20,m=[],x=[];r.prototype.getElementMap=function(){return m},r.prototype.getDisplay=function(){return x},r.prototype.unfoldUpdateStatus=function(t){var e=m.get(t);if(e.fold){for(var n=e.children,r=10,i=x.indexOf(e)+1,a=0;a<n.length;a++){var s=m.get(n[a]);s.x=r+e.x,x.splice(i,0,s),i++,r+=s.width+v}for(var o=r-v+10-e.width;i<x.length;)x[i].x+=o,i++;e.width+=o,e.y-=10,e.height+=20,e.fold=!1;for(var l=e;-1!=l.parent;)l=m.get(l.parent),l.width+=o,l.height+=20,l.y-=10}},r.prototype.foldUpdateStatus=function(t){var e=m.get(t);if(!e.fold){for(var n=e.children,r=0,i=0;i<n.length;i++){var a=m.get(n[i]);r=x.indexOf(a),x.splice(r,1)}for(var s=e.width-(10*e.displayName.length+2*v);r<x.length;)x[r].x-=s,r++;e.width-=s,e.y+=10,e.height-=20,e.fold=!0;for(var o=e;-1!=o.parent;)o=m.get(o.parent),o.width-=s,o.height-=20,o.y+=10}},i.prototype.sameRepresent=function(t){if(this.represent.length!=t.represent.length)return!1;for(var e=0;e<this.represent.length;e++)if(!this.represent[e].equals(t.represent[e]))return!1;return!0};var w;a.prototype.draw=function(){c();for(var t=w.getDisplay(),e=0;e<t.length;e++)d(t[e])};var E=40,G=4,M=10,b=E;t.SDController=a,Object.defineProperty(t,"__esModule",{value:!0})});